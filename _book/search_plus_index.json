{"./":{"url":"./","title":"Introduction","keywords":"","body":"1. èµ„æ–™2. å£°æ˜3. å­¦ä¹ èµ„æ–™æ¨è1. èµ„æ–™ Download PDF: Elasticsearchåˆ†äº«ç¬¬ä¸€æœŸpptDownload PDF: Elasticsearchç¬¬ä¸€æœŸ 2. å£°æ˜ æœ¬æ‰‹å†Œæ‰€æœ‰æ“ä½œå‡åŸºäºElasticsearch6.4ç‰ˆæœ¬ å®æˆ˜æ¼”ç»ƒç¯å¢ƒï¼š ä¸ºä¸ªäººé˜¿é‡Œäº‘ECSæ­å»º ESåœ°å€ kibanaåœ°å€ 3. å­¦ä¹ èµ„æ–™æ¨è ã€ŠElasticsearchå®˜æ–¹æœ€æ–°æ–‡æ¡£ ã€‹ ã€ŠElasticsearch:æƒå¨æŒ‡å— ã€‹ ã€Škibanaä½¿ç”¨æ‰‹å†Œå®˜æ–¹ä¸­æ–‡æ–‡æ¡£ ã€‹ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/invert_index_simple_apply.html":{"url":"first/invert_index_simple_apply.html","title":"ç¬¬ä¸€æœŸ","keywords":"","body":"1. å€’æ’ç´¢å¼•åœ¨elasticsearchä¸­çš„ç®€å•åº”ç”¨1.1. åˆ›å»ºç´¢å¼•1.2. æ’å…¥ä¸€æ¡æ•°æ®1.3. å¯¹æ•°æ®è¿›è¡Œæœç´¢1. å€’æ’ç´¢å¼•åœ¨elasticsearchä¸­çš„ç®€å•åº”ç”¨ å› ä¸ºæ¼”ç¤ºçš„ESé›†ç¾¤åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªæ¨¡æ¿ï¼Œæ‰€æœ‰ç´¢å¼•ä¸è®¾ç½®å‰¯æœ¬ { \"order\": 0, \"index_patterns\": [ \"*\" ], \"settings\": { \"index\": { \"number_of_shards\": \"2\", \"number_of_replicas\": \"0\" } }, \"mappings\": {}, \"aliases\": {} } 1.1. åˆ›å»ºç´¢å¼• PUT elasticsearch_study_index { \"aliases\": {}, \"settings\": { \"index\": { \"number_of_shards\": \"2\", \"number_of_replicas\": \"0\" } }, \"mappings\": { \"_doc\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"whitespace\" }, \"author\":{ \"type\": \"keyword\", \"ignore_above\": 256 }, \"content\": { \"type\": \"text\", \"fields\": { \"space\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } }, \"descripe\": { \"type\": \"text\", \"analyzer\": \"standard\" } } } } } 1.2. æ’å…¥ä¸€æ¡æ•°æ® POST elasticsearch_study_index/_doc/1 { \"title\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼Œæ¢ç´¢æœªæ¥æ•™è‚²æ–°æ¨¡å¼çš„ç§‘æŠ€æ•™è‚²å…¬å¸ã€‚\" } 1.3. å¯¹æ•°æ®è¿›è¡Œæœç´¢ #æœç´¢ä¸åˆ°æ•°æ® GET elasticsearch_study_index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœª\" } } } # èƒ½å¤Ÿæœç´¢æ•°æ® GET elasticsearch_study_index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥\" } } } æŸ¥çœ‹whitespaceåˆ†è¯ç»“æœ POST elasticsearch_study_index/_analyze { \"analyzer\": \"whitespace\", \"text\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼Œæ¢ç´¢æœªæ¥æ•™è‚²æ–°æ¨¡å¼çš„ç§‘æŠ€æ•™è‚²å…¬å¸ã€‚\" } Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/basic_concept.html":{"url":"first/basic_concept.html","title":"åŸºæœ¬æ¦‚å¿µ","keywords":"","body":"1. ElasticsearchåŸºæœ¬æ¦‚å¿µ1.1. é›†ç¾¤ï¼ˆclusterï¼‰1.2. èŠ‚ç‚¹ï¼ˆnodeï¼‰1.3. ç´¢å¼•ï¼ˆindexï¼‰1.4. ç±»å‹ï¼ˆtypeï¼‰1.5. æ–‡æ¡£ï¼ˆdocumentï¼‰1.6. å­—æ®µï¼ˆfieldï¼‰1.7. æ˜ å°„ï¼ˆmappingï¼‰1.8. åˆ†ç‰‡ï¼ˆshardsï¼‰1.9. æ®µï¼ˆsegementsï¼‰1. ElasticsearchåŸºæœ¬æ¦‚å¿µ 1.1. é›†ç¾¤ï¼ˆclusterï¼‰ â€ƒâ€ƒ ä¸€ä¸ªElasticsearché›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªESèŠ‚ç‚¹ç»„æˆï¼Œå¹¶æä¾›é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢èƒ½åŠ›ï¼ˆæ‰€æœ‰èŠ‚ç‚¹å…±åŒå­˜å‚¨æ•°æ®ï¼‰ã€‚â€ƒâ€ƒ ä¸€ä¸ªé›†ç¾¤è¢«å‘½åä¸ºå”¯ä¸€çš„åå­—ï¼ˆé»˜è®¤ä¸ºelasticsearchï¼‰ï¼Œé›†ç¾¤åç§°éå¸¸é‡è¦ï¼Œå› ä¸ºèŠ‚ç‚¹éœ€è¦é€šè¿‡é›†ç¾¤çš„åç§°åŠ å…¥é›†ç¾¤ã€‚é›†ç¾¤çš„çš„çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼šgreen,yellow,redgreenâ€ƒâ€ƒé›†ç¾¤æ‰€æœ‰ç´¢å¼•çš„åˆ†ç‰‡ï¼ˆshardï¼‰éƒ½è¢«æ­£å¸¸çš„åˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼›yellowâ€ƒâ€ƒé›†ç¾¤ä¸­æœ‰ç´¢å¼•å­˜åœ¨å‰¯æœ¬åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼›redâ€ƒâ€ƒé›†ç¾¤ä¸­æœ‰ç´¢å¼•å­˜åœ¨ä¸»åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼› æŸ¥çœ‹é›†ç¾¤å¥åº·ä¿¡æ¯ GET _cluster/health?pretty GET _cat/health?format=json 1.2. èŠ‚ç‚¹ï¼ˆnodeï¼‰ â€ƒâ€ƒä¸€ä¸ªèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®å¹¶å‚ä¸é›†ç¾¤çš„ç´¢å¼•å’Œæœç´¢ã€‚å’Œé›†ç¾¤ç±»ä¼¼ï¼ŒèŠ‚ç‚¹ç”±ä¸€ä¸ªåç§°æ¥æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åç§°æ˜¯åœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶åˆ†é…ç»™èŠ‚ç‚¹çš„éšæœºé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ã€‚æ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä»»æ„èŠ‚ç‚¹çš„åç§°ï¼ŒèŠ‚ç‚¹åç§°å¯¹äºç®¡ç†å·¥ä½œå¾ˆé‡è¦ï¼Œ å› ä¸ºé€šè¿‡èŠ‚ç‚¹åç§°å¯ä»¥ç¡®å®šç½‘ç»œä¸­çš„å“ªäº›æœåŠ¡å™¨å¯¹åº”äºElasticsearché›†ç¾¤ä¸­çš„å“ªäº›èŠ‚ç‚¹ã€‚â€ƒâ€ƒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥è¢«æ·»åŠ åˆ°æŒ‡å®šåç§°çš„é›†ç¾¤ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šè¢«è®¾ç½®åŠ å…¥åˆ°åç§°ä¸ºelasticsearchçš„é›†ç¾¤ä¸­ï¼Œ è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨æ‚¨åœ¨ç½‘ç»œä¸­å¯åŠ¨äº†æŸäº›èŠ‚ç‚¹ï¼ˆå‡è®¾è¿™äº›èŠ‚ç‚¹å¯ä»¥å‘ç°å½¼æ­¤ï¼‰ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨å½¢æˆå¹¶åŠ å…¥åç§°ä¸ºelasticsearchçš„é›†ç¾¤ä¸­ã€‚â€ƒâ€ƒä¸€ä¸ªé›†ç¾¤å¯ä»¥æ‹¥æœ‰ä»»æ„å¤šçš„èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨æ‚¨çš„ç½‘ç»œä¸­æ²¡æœ‰è¿è¡Œä»»ä½•ElasticsearchèŠ‚ç‚¹ï¼Œ æ­¤æ—¶å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªåç§°ä¸ºelasticsearchçš„å•èŠ‚ç‚¹é›†ç¾¤ã€‚ èŠ‚ç‚¹çš„è§’è‰²å¯ä»¥ï¼Œç”±ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°æ¥å†³å®šï¼Œä¸åŒè§’è‰²ï¼Œå¯ä»¥ä¸“æ³¨äºå®Œæˆä¸åŒçš„äº‹ï¼š node.master: true node.data: true node.ingestï¼štrue Master Node(ä¸“æœ‰ä¸»èŠ‚ç‚¹)å¦‚æœèŠ‚ç‚¹ä¸ºä»¥ä¸‹é…ç½®ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸ºä¸“æœ‰å€™é€‰ä¸»èŠ‚ç‚¹ï¼›å¦‚æœé€‰ä¸¾æˆåŠŸï¼Œåˆ™è¯¥èŠ‚ç‚¹æˆä¸ºmaster,masterèŠ‚ç‚¹ä¸€èˆ¬ä¸ç”¨äºå’Œåº”ç”¨åˆ›å»ºè¿æ¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜äº†é›†ç¾¤çŠ¶æ€ï¼ŒmasterèŠ‚ç‚¹ä¸å ç”¨ç£ç›˜IOå’ŒCPUï¼Œå†…å­˜ä½¿ç”¨é‡ä¸€èˆ¬ã€‚å…¶ä»–æ²¡æœ‰é€‰ä¸¾æˆä¸ºmasterèŠ‚ç‚¹çš„ï¼Œä»ç„¶ä¿æŒå€™é€‰ä¸»èŠ‚ç‚¹çš„èº«ä»½ï¼Œéœ€è¦å’Œå ç”¨çš„èµ„æºæ¯”masterèŠ‚ç‚¹æ›´å°‘ã€‚ # å…·æœ‰èµ„æ ¼é€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹çš„ï¼Œå€™é€‰èŠ‚ç‚¹ node.master: true node.data: false node.ingestï¼šfalse masterèŠ‚ç‚¹æ§åˆ¶æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®ã€‚åªæœ‰Master NodeèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯åŠå…ƒæ•°æ®(metadata)çš„å¤„ç†ï¼Œ æ¯”å¦‚ç´¢å¼•çš„æ–°å¢ã€åˆ é™¤ã€åˆ†ç‰‡è·¯ç”±åˆ†é…ã€æ‰€æœ‰ç´¢å¼•å’Œç›¸å…³ Mapping ã€Setting é…ç½®ç­‰ç­‰ã€‚ å€™é€‰èŠ‚ç‚¹ï¼šä¸é›†ç¾¤ä¿æŒå¿ƒè·³ï¼Œåˆ¤æ–­Masteræ˜¯å¦å­˜æ´»ï¼Œå¦‚æœMasteræ•…éšœåˆ™å‚åŠ æ–°ä¸€è½®çš„Masteré€‰ä¸¾ é›†ç¾¤è§„åˆ’ ï¼š Elasticsearché›†ç¾¤å»ºè®®masterè‡³å°‘ä¸‰å°(ç”Ÿäº§å»ºè®®æ¯ä¸ªeså®ä¾‹éƒ¨ç½²åœ¨ä¸åŒçš„è®¾å¤‡ä¸Š)ï¼Œä¸‰ä¸ªMasterèŠ‚ç‚¹æœ€å¤šåªèƒ½æ•…éšœä¸€å°MasterèŠ‚ç‚¹ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¦‚æœä¸‰ä¸ªèŠ‚ç‚¹æ•…éšœä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆ™é€ æˆæ•°æ®ä¸¢å¤±å¹¶æ— æ³•ç»„æˆé›†ç¾¤ã€‚ Data Node(ä¸“æœ‰æ•°æ®èŠ‚ç‚¹)æ•°æ®èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å’Œç´¢å¼•åº”ç”¨åˆ›å»ºè¿æ¥ã€æ¥æ”¶ç´¢å¼•è¯·æ±‚ï¼Œè¯¥èŠ‚ç‚¹çœŸæ­£å­˜å‚¨æ•°æ®ï¼ŒESé›†ç¾¤çš„æ€§èƒ½å–å†³äºè¯¥èŠ‚ç‚¹çš„ä¸ªæ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€ä¼˜é…ç½®çš„æƒ…å†µä¸‹ï¼‰ï¼ŒdataèŠ‚ç‚¹ä¼šå ç”¨å¤§é‡çš„CPUã€IOå’Œå†…å­˜ã€‚ dataèŠ‚ç‚¹çš„åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥è·å¾—æŸ¥è¯¢ç»“æœåå°†ç»“æœåé¦ˆç»™åè°ƒèŠ‚ç‚¹ï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­éå¸¸æ¶ˆè€—ç¡¬ä»¶èµ„æºï¼Œå¦‚æœåœ¨åˆ†ç‰‡é…ç½®åŠä¼˜åŒ–æ²¡åšå¥½çš„æƒ…å†µä¸‹, è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢éå¸¸ç¼“æ…¢(ç¡¬ä»¶é…ç½®ä¹Ÿè¦è·Ÿä¸Šæ•°æ®é‡)ã€‚ åœ¨Elasticsearché›†ç¾¤ä¸­ï¼Œæ­¤èŠ‚ç‚¹åº”è¯¥æ˜¯æœ€å¤šçš„ï¼Œå•ä¸ªç´¢å¼•åœ¨ä¸€ä¸ªdataèŠ‚ç‚¹å®ä¾‹ä¸Šåˆ†ç‰‡æ•°ä¿æŒåœ¨3ä¸ªä»¥å†…(å»ºè®®åˆ†ç‰‡æ•°é‡æŒ‰ç…§DataèŠ‚ç‚¹æ•°é‡åˆ’åˆ†æ¯”è¾ƒå¥½ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸€ä¸ªåˆ†ç‰‡)ï¼›æ¯1GBå †å†…å­˜å¯¹åº”é›†ç¾¤çš„åˆ†ç‰‡ä¿æŒåœ¨20ä¸ªä»¥å†…ï¼›æ¯ä¸ªåˆ†ç‰‡å¤§å°ä¸è¦è¶…è¿‡30Gï¼Œçº¯æœç´¢å‹å»ºè®®ä¸è¶…è¿‡10GBï¼Œæ—¥å¿—å‹å»ºè®®30GB-50GBã€‚ node.master: false node.data: true node.ingestï¼šfalse å†…å­˜å»ºè®®: å‡å¦‚ä¸€å°æœºå™¨éƒ¨ç½²äº†ä¸€ä¸ªESå®ä¾‹ï¼Œåˆ™ESæœ€å¤§å¯ç”¨å†…å­˜ç»™åˆ°ç‰©ç†å†…å­˜çš„50%ï¼Œæœ€å¤šä¸å¯è¶…è¿‡32Gï¼ˆå¦‚æœè¶…è¿‡32GBï¼Œjvmå°†ä¼šä½¿ç”¨é•¿æŒ‡é’ˆï¼Œå®˜æ–¹å»ºè®®å †å†…å­˜åˆ†é…ä¸º26-32GBï¼‰ã€‚ å¦‚æœå•å°æœºå™¨ä¸Šéƒ¨ç½²äº†å¤šä¸ªESå®ä¾‹ï¼Œåˆ™å¤šä¸ªESå®ä¾‹å†…å­˜ç›¸åŠ ç­‰äºç‰©ç†å†…å­˜çš„50%ï¼Œå¤šä¸ªESå®ä¾‹å†…å­˜ç›¸åŠ ä¸å®œè¶…è¿‡32Gã€‚ åˆ†ç‰‡å»ºè®®ï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼‰ï¼šå¦‚æœå•ä¸ªåˆ†ç‰‡æ¯ä¸ªèŠ‚ç‚¹å¯æ”¯æ’‘90Gæ•°æ®ï¼Œä¾æ­¤å¯è®¡ç®—å‡ºæ‰€éœ€dataèŠ‚ç‚¹æ•°ã€‚å¦‚æœå¤šä¸ªåˆ†ç‰‡æŒ‰ç…§å•ä¸ªdataèŠ‚ç‚¹jvmå†…å­˜æœ€å¤§30Gæ¥è®¡ç®—ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†ç‰‡ä¿æŒåœ¨600ä¸ªä»¥å†…ï¼Œå­˜å‚¨ä¿æŒåœ¨18Tä»¥å†…ã€‚ Ingest Node(ä¸“æœ‰æ•°æ®é¢„å¤„ç†èŠ‚ç‚¹)ingest èŠ‚ç‚¹å¯ä»¥çœ‹ä½œæ˜¯æ•°æ®å‰ç½®å¤„ç†è½¬æ¢çš„èŠ‚ç‚¹ï¼Œæ”¯æŒ pipelineç®¡é“ è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ ingest å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç±»ä¼¼äº logstash ä¸­ filter çš„ä½œç”¨ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ã€‚ IngestèŠ‚ç‚¹å¤„ç†æ—¶æœºâ€”â€”åœ¨æ•°æ®è¢«ç´¢å¼•ä¹‹å‰ï¼Œé€šè¿‡é¢„å®šä¹‰å¥½çš„å¤„ç†ç®¡é“å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ç”¨Ingestï¼Œå› æ­¤ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥å¤„ç†Ingestä»»åŠ¡ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºä¸“ç”¨çš„IngestèŠ‚ç‚¹ã€‚ é€šå¸¸æ•°æ®çš„åŠ å·¥å»ºè®®ï¼Œæ”¾åœ¨ä¸“æœ‰çš„æ•°æ® ETLç»„ä»¶ä¸­ node.master: false node.data: false node.ingestï¼štrue Coordinating Node(ä¸“æœ‰åè°ƒèŠ‚ç‚¹)åè°ƒèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å’Œæ£€ç´¢åº”ç”¨åˆ›å»ºè¿æ¥ã€æ¥å—æ£€ç´¢è¯·æ±‚ï¼Œä½†å…¶æœ¬èº«ä¸è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œå¯å½“è´Ÿè´£å‡è¡¡èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å ç”¨ioã€cpuå’Œå†…å­˜ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸åˆç†çš„èšåˆæŸ¥è¯¢ï¼Œä¹Ÿä¼šå¯¼è‡´åè°ƒèŠ‚ç‚¹oomã€‚ åè°ƒèŠ‚ç‚¹æ¥å—å®¢æˆ·ç«¯æœç´¢è¯·æ±‚åå°†è¯·æ±‚è½¬å‘åˆ°ä¸æŸ¥è¯¢æ¡ä»¶ç›¸å…³çš„å¤šä¸ªdataèŠ‚ç‚¹çš„åˆ†ç‰‡ä¸Šï¼Œç„¶åå¤šä¸ªdataèŠ‚ç‚¹çš„åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æˆ–è€…æŸ¥è¯¢ç»“æœå†è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹æŠŠå„ä¸ªdataèŠ‚ç‚¹çš„è¿”å›ç»“æœè¿›è¡Œæ•´åˆã€æ’åºç­‰ä¸€ç³»åˆ—æ“ä½œåå†å°†æœ€ç»ˆç»“æœè¿”å›ç»™ç”¨æˆ·è¯·æ±‚ å¢åŠ åè°ƒèŠ‚ç‚¹å¯å¢åŠ æ£€ç´¢å¹¶å‘,ä½†æ£€ç´¢çš„é€Ÿåº¦è¿˜æ˜¯å–å†³äºæŸ¥è¯¢æ‰€å‘½ä¸­çš„åˆ†ç‰‡ä¸ªæ•°ä»¥åŠåˆ†ç‰‡ä¸­çš„æ•°æ®é‡ node.master: false node.data: false node.ingestï¼šfalse æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ GET _cat/nodes?v&format=txt 1.3. ç´¢å¼•ï¼ˆindexï¼‰ â€ƒâ€ƒä¸€ä¸ªç´¢å¼•æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€äº›ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£çš„é›†åˆï¼ˆç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®åº“ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå®¢æˆ·æ•°æ®çš„ç´¢å¼•ï¼Œä»¥åŠä¸€ä¸ªè®¢å•æ•°æ®çš„ç´¢å¼•ã€‚ ä¸€ä¸ªç´¢å¼•é€šå¸¸ä½¿ç”¨ä¸€ä¸ªåç§°ï¼ˆæ‰€æœ‰å­—æ¯å¿…é¡»å°å†™ï¼‰æ¥æ ‡è¯†ï¼Œ å½“é’ˆå¯¹è¿™ä¸ªç´¢å¼•çš„æ–‡æ¡£æ‰§è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œè¿™ä¸ªåç§°è¢«ç”¨æ¥æŒ‡å‘ç´¢å¼•ã€‚ è¡¨ 1-1 Elasticsearchä¸å…³ç³»å‹æ•°æ®åº“çš„å¯¹åº”å…³ç³» Elasticsearch å…³ç³»å‹æ•°æ®åº“ ç´¢å¼•ï¼ˆindexï¼‰ HTTPæ–¹æ³•ï¼ŒåŒ…æ‹¬GETã€POSTã€PUTã€HEADã€DELETEã€‚ æ–‡æ¡£ç±»å‹ï¼ˆtypeï¼‰ï¼Œes6ç‰ˆæœ¬ä¹‹åä¸€ä¸ªindexåªèƒ½æœ‰ä¸€ä¸ªtype æ•°æ®åº“ï¼ˆDatabaseï¼‰ æ–‡æ¡£ï¼ˆdocumentï¼‰ ä¸€è¡Œæ•°æ®ï¼ˆRowï¼‰ å­—æ®µï¼ˆfieldï¼‰ ä¸€åˆ—æ•°æ®ï¼ˆColumnï¼‰ æ˜ å°„ï¼ˆmappingï¼‰ æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ â€ƒâ€ƒåœ¨Elasticsearchä¸­ç´¢å¼•ä¸€è¯ï¼Œæœ‰å¤šç§å«ä¹‰ï¼š Index Versus â€ƒâ€ƒä½ ä¹Ÿè®¸å·²ç»æ³¨æ„åˆ° ç´¢å¼• è¿™ä¸ªè¯åœ¨ Elasticsearch è¯­å¢ƒä¸­æœ‰å¤šç§å«ä¹‰ï¼Œ è¿™é‡Œæœ‰å¿…è¦åšä¸€äº›è¯´æ˜ï¼š ç´¢å¼•ï¼ˆåè¯ï¼‰ï¼šâ€ƒâ€ƒå¦‚å‰æ‰€è¿°ï¼Œä¸€ä¸ª ç´¢å¼• ç±»ä¼¼äºä¼ ç»Ÿå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€ä¸ª æ•°æ®åº“ ï¼Œæ˜¯ä¸€ä¸ªå­˜å‚¨å…³ç³»å‹æ–‡æ¡£çš„åœ°æ–¹ã€‚ ç´¢å¼• (index) çš„å¤æ•°è¯ä¸º indices æˆ– indexes ã€‚ ç´¢å¼•ï¼ˆåŠ¨è¯ï¼‰ï¼šâ€ƒâ€ƒç´¢å¼•ä¸€ä¸ªæ–‡æ¡£ å°±æ˜¯å­˜å‚¨ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ª ç´¢å¼• ï¼ˆåè¯ï¼‰ä¸­ä»¥ä¾¿è¢«æ£€ç´¢å’ŒæŸ¥è¯¢ã€‚ è¿™éå¸¸ç±»ä¼¼äº SQL è¯­å¥ä¸­çš„ INSERT å…³é”®è¯ï¼Œé™¤äº†æ–‡æ¡£å·²å­˜åœ¨æ—¶ï¼Œæ–°æ–‡æ¡£ä¼šæ›¿æ¢æ—§æ–‡æ¡£æƒ…å†µä¹‹å¤–ã€‚ å€’æ’ç´¢å¼•ï¼šâ€ƒâ€ƒå…³ç³»å‹æ•°æ®åº“é€šè¿‡å¢åŠ ä¸€ä¸ª ç´¢å¼• æ¯”å¦‚ä¸€ä¸ª Bæ ‘ï¼ˆB-treeï¼‰ç´¢å¼• åˆ°æŒ‡å®šçš„åˆ—ä¸Šï¼Œ ä»¥ä¾¿æå‡æ•°æ®æ£€ç´¢é€Ÿåº¦ã€‚Elasticsearch å’Œ Lucene ä½¿ç”¨äº†ä¸€ä¸ªå«åš å€’æ’ç´¢å¼• çš„ç»“æ„æ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ â€ƒâ€ƒé»˜è®¤çš„ï¼Œä¸€ä¸ªæ–‡æ¡£ä¸­çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æ˜¯ è¢«ç´¢å¼• çš„ï¼ˆæœ‰ä¸€ä¸ªå€’æ’ç´¢å¼•ï¼‰å’Œå¯æœç´¢çš„ã€‚ ä¸€ä¸ªæ²¡æœ‰å€’æ’ç´¢å¼•çš„å±æ€§æ˜¯ä¸èƒ½è¢«æœç´¢åˆ°çš„ã€‚ ç´¢å¼•çš„çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼šgreen,yellow,redgreenâ€ƒâ€ƒç´¢å¼•çš„åˆ†ç‰‡ï¼ˆshardï¼‰éƒ½è¢«æ­£å¸¸çš„åˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼›yellowâ€ƒâ€ƒç´¢å¼•å­˜åœ¨å‰¯æœ¬åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼›redâ€ƒâ€ƒç´¢å¼•å­˜åœ¨ä¸»åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼› 1.4. ç±»å‹ï¼ˆtypeï¼‰ â€ƒâ€ƒä¸€ä¸ªç±»å‹é€šå¸¸æ˜¯ä¸€ä¸ªç´¢å¼•çš„ä¸€ä¸ªé€»è¾‘åˆ†ç±»æˆ–åˆ†åŒºï¼Œå…è®¸åœ¨ä¸€ä¸ªç´¢å¼•ä¸‹å­˜å‚¨ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼‰ ï¼Œä¾‹å¦‚ç”¨æˆ·ç±»å‹ã€è®¢å•ç±»å‹ç­‰ã€‚ç›®å‰å·²ç»ä¸æ”¯æŒåœ¨ä¸€ä¸ªç´¢å¼•ä¸‹åˆ›å»ºå¤šä¸ªç±»å‹ï¼Œå¹¶ä¸”ç±»å‹æ¦‚å¿µå·²ç»åœ¨åç»­ç‰ˆæœ¬ä¸­åˆ é™¤ï¼Œ è¯¦æƒ…è¯·å‚è§Elasticsearchå®˜æ–¹æ–‡æ¡£ã€‚ 1.5. æ–‡æ¡£ï¼ˆdocumentï¼‰ â€ƒâ€ƒElasticsearch æ˜¯ é¢å‘æ–‡æ¡£ çš„ï¼Œæ„å‘³ç€å®ƒå­˜å‚¨æ•´ä¸ªå¯¹è±¡æˆ– æ–‡æ¡£ã€‚Elasticsearch ä¸ä»…å­˜å‚¨æ–‡æ¡£ï¼Œ è€Œä¸” ç´¢å¼• æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ï¼Œ ä½¿ä¹‹å¯ä»¥è¢«æ£€ç´¢ã€‚åœ¨ Elasticsearch ä¸­ï¼Œæˆ‘ä»¬å¯¹æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æ£€ç´¢ã€æ’åºå’Œè¿‡æ»¤â€”â€‹è€Œä¸æ˜¯å¯¹è¡Œåˆ—æ•°æ®ã€‚ è¿™æ˜¯ä¸€ç§å®Œå…¨ä¸åŒçš„æ€è€ƒæ•°æ®çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ Elasticsearch èƒ½æ”¯æŒå¤æ‚å…¨æ–‡æ£€ç´¢çš„åŸå› ã€‚ å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ–‡æ¡£çš„idï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥ç›´æ¥æ”¹æ–‡æ¡£ GET elasticsearch_study_index/_doc/1 1.6. å­—æ®µï¼ˆfieldï¼‰ â€ƒâ€ƒç»„æˆæ–‡æ¡£çš„æœ€å°å•ä½ã€‚ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€åˆ—æ•°æ®ã€‚ 1.7. æ˜ å°„ï¼ˆmappingï¼‰ â€ƒâ€ƒç”¨æ¥å®šä¹‰ä¸€ä¸ªæ–‡æ¡£ä»¥åŠå…¶æ‰€åŒ…å«çš„å­—æ®µå¦‚ä½•è¢«å­˜å‚¨å’Œç´¢å¼•ï¼Œ ä¾‹å¦‚åœ¨mappingä¸­å®šä¹‰å­—æ®µçš„åç§°å’Œç±»å‹ï¼Œä»¥åŠæ‰€ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„Schemaã€‚ 1.8. åˆ†ç‰‡ï¼ˆshardsï¼‰ â€ƒâ€ƒä»£è¡¨ç´¢å¼•åˆ†ç‰‡ï¼ŒElasticsearchå¯ä»¥æŠŠä¸€ä¸ªå®Œæ•´çš„ç´¢å¼•åˆ†æˆå¤šä¸ªåˆ†ç‰‡,å³ä¸€ä¸ªç´¢å¼•è¡¨å…¶å®æ˜¯ä¸€ç»„shardçš„é€»è¾‘è§†å›¾ï¼Œ è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æŠŠä¸€ä¸ªå¤§çš„ç´¢å¼•æ‹†åˆ†æˆå¤šä¸ªï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ„æˆåˆ†å¸ƒå¼æœç´¢ã€‚ åˆ†ç‰‡çš„æ•°é‡åªèƒ½åœ¨ç´¢å¼•åˆ›å»ºå‰æŒ‡å®šï¼Œå¹¶ä¸”ç´¢å¼•åˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚ 1.9. æ®µï¼ˆsegementsï¼‰ æ¯ä¸ªshardåˆ†ç‰‡æ˜¯ä¸€ä¸ªluceneå®ä¾‹ï¼Œæ¯ä¸ªåˆ†ç‰‡ç”±å¤šä¸ªsegmentç»„æˆã€‚æ¯ä¸ªsegmentå ç”¨å†…å­˜ï¼Œæ–‡ä»¶å¥æŸ„ç­‰ã€‚æœåŠ¡å™¨æ€»å†…å­˜é™¤äº†åˆ†é…jvmé…ç½®çš„ï¼Œå…¶ä½™éƒ½ç»™äº†luceneï¼Œå ç”¨page cacheå†…å­˜ï¼Œpage cacheä¿å­˜å¯¹æ–‡ä»¶æ•°æ®segmentçš„ç¼“å­˜ã€‚free -gå¯æŸ¥çœ‹å†…å­˜ä½¿ç”¨ï¼ŒesèŠ‚ç‚¹åªæœ‰esæœåŠ¡ï¼ŒåŸºæœ¬cacheå°±æ˜¯ç¼“å­˜çš„segment #æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰ç´¢å¼•segementsçš„æƒ…å†µ GET _cat/segments?v #æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹segementså ç”¨çš„å †å†…å­˜ GET _cat/nodes?v&h=ip,ram.percent,sm #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„segementsçš„æƒ…å†µ GET _cat/segments/elasticsearch_study_index?v Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/elasticsearch_lucene_segments.html":{"url":"first/elasticsearch_lucene_segments.html","title":"Elasticsearchã€Luceneã€Segments","keywords":"","body":"1. Elasticsearchã€Luceneã€Segments1. Elasticsearchã€Luceneã€Segments Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/analyzer_example.html":{"url":"first/analyzer_example.html","title":"åˆ†è¯å™¨","keywords":"","body":"1. åˆ†è¯å™¨1.1. è‡ªå®šä¹‰åˆ†è¯1. åˆ†è¯å™¨ 1.1. è‡ªå®šä¹‰åˆ†è¯ PUT elasticsearch-analyzer-index { \"settings\": { \"analysis\": { \"analyzer\": { \"my_custom_analyzer\": { \"type\": \"custom\", \"char_filter\": [ \"emoticons\" , \"html_strip\" ], \"tokenizer\": \"punctuation\", \"filter\": [ \"lowercase\", \"english_stop\", \"asciifolding\" ] } }, \"tokenizer\": { \"punctuation\": { \"type\": \"pattern\", \"pattern\": \"[ .,!?ã€‚]\" } }, \"char_filter\": { \"emoticons\": { \"type\": \"mapping\", \"mappings\": [ \":) => _happy_\", \":( => _sad_\", \"ğŸ‚ => ç‰›\" ] } }, \"filter\": { \"english_stop\": { \"type\": \"stop\", \"stopwords\": \"_english_\" } } } }, \"mappings\": { \"_doc\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"my_custom_analyzer\", \"search_analyzer\": \"my_custom_analyzer\" }, \"author\":{ \"type\": \"keyword\", \"ignore_above\": 256 }, \"content\": { \"type\": \"text\", \"fields\": { \"space\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } }, \"descripe\": { \"type\": \"text\", \"analyzer\": \"standard\" } } } } } æ£€æµ‹åˆ†è¯ç»“æœ POST elasticsearch-analyzer-index/_analyze { \"analyzer\": \"my_custom_analyzer\", \"text\": \"I'm a :) person, and you?å¥½æœªæ¥ğŸ‚\" } POST elasticsearch-analyzer-index/_analyze { \"analyzer\": \"my_custom_analyzer\", \"text\": \"Is this dÃ©jÃ  vu?\" } å“åº”ç»“å¦‚ä¸‹ { \"tokens\": [ { \"token\": \"i'm\", \"start_offset\": 0, \"end_offset\": 3, \"type\": \"word\", \"position\": 0 }, { \"token\": \"_happy_\", \"start_offset\": 6, \"end_offset\": 8, \"type\": \"word\", \"position\": 2 }, { \"token\": \"person\", \"start_offset\": 9, \"end_offset\": 15, \"type\": \"word\", \"position\": 3 }, { \"token\": \"you\", \"start_offset\": 21, \"end_offset\": 24, \"type\": \"word\", \"position\": 5 }, { \"token\": \"\"\" å¥½æœªæ¥ç‰› \"\"\", \"start_offset\": 25, \"end_offset\": 37, \"type\": \"word\", \"position\": 6 } ] } æ’å…¥æ•°æ® POST elasticsearch-analyzer-index/_doc/1 { \"title\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼ŒI'm a :) person, and you?å¥½æœªæ¥ğŸ‚ã€‚\" } POST elasticsearch-analyzer-index/_doc/_bulk?refresh {\"index\":{}} {\"author\":\"æå››1\" ,\"title\": \"å¥½æœªæ¥æ˜¯ ä¸€ä¸ª ä»¥ æ™ºæ…§æ•™è‚² å’Œ å¼€æ”¾å¹³å° ä¸º ä¸»ä½“ã€‚å¥½æœªæ¥ğŸ‚\"} {\"index\":{}} {\"author\":\"æå››2\" ,\"title\": \"å¥½æœªæ¥ æ˜¯ ä¸€ä¸ª ä»¥ æ™ºæ…§æ•™è‚²å’Œ å¼€æ”¾å¹³å° ä¸º ä¸»ä½“ï¼Œæ¢ç´¢ æœªæ¥ æ•™è‚² æ–°æ¨¡å¼ çš„ ç§‘æŠ€æ•™è‚² å…¬å¸ã€‚\"} æœç´¢ POST elasticsearch-analyzer-index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥ç‰›\" } } } POST elasticsearch-analyzer-index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥\" } } } å®˜æ–¹æ–‡æ¡£analysis Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "}}
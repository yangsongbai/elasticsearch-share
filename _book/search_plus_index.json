{"./":{"url":"./","title":"Introduction","keywords":"","body":"1. èµ„æ–™2. å£°æ˜3. å­¦ä¹ èµ„æ–™æ¨è1. èµ„æ–™ Download PPT: Elasticsearchåˆ†äº«ç¬¬ä¸€æœŸPPTDownload PDF: Elasticsearchç¬¬ä¸€æœŸæ–‡æ¡£ éƒ¨ç½²ç¯å¢ƒä¸ºcentos7+,jdk1.8,elasticsearch6.4.0Download install-jdk.sh: JDKéƒ¨ç½²è„šæœ¬Download install-elasticsearch.sh: Elasticsearchå•èŠ‚ç‚¹éƒ¨ç½²è„šæœ¬ 2. å£°æ˜ æœ¬æ‰‹å†Œæ‰€æœ‰æ“ä½œå‡åŸºäºElasticsearch6.4ç‰ˆæœ¬ï¼›æœ¬è¯¾ç¨‹æ˜¯ä¸€é—¨åŸç†+å®æˆ˜çš„è¯¾ç¨‹ã€‚ å®æˆ˜æ¼”ç»ƒç¯å¢ƒï¼š ä¸ºä¸ªäººé˜¿é‡Œäº‘ECSæ­å»º ESåœ°å€ kibanaåœ°å€ 3. å­¦ä¹ èµ„æ–™æ¨è ã€ŠElasticsearchå®˜æ–¹æœ€æ–°æ–‡æ¡£ ã€‹ ã€ŠElasticsearch:æƒå¨æŒ‡å— ã€‹ ã€Škibanaä½¿ç”¨æ‰‹å†Œå®˜æ–¹ä¸­æ–‡æ–‡æ¡£ ã€‹ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-31 "},"first/part02/invert_index_simple_apply.html":{"url":"first/part02/invert_index_simple_apply.html","title":"ç¬¬ä¸€æœŸ","keywords":"","body":"1. å€’æ’ç´¢å¼•åœ¨elasticsearchä¸­çš„ç®€å•åº”ç”¨1.1. åˆ›å»ºç´¢å¼•1.2. æ’å…¥ä¸€æ¡æ•°æ®1.3. å¯¹æ•°æ®è¿›è¡Œæœç´¢1. å€’æ’ç´¢å¼•åœ¨elasticsearchä¸­çš„ç®€å•åº”ç”¨ å› ä¸ºæ¼”ç¤ºçš„ESé›†ç¾¤åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ªæ¨¡æ¿ï¼Œæ‰€æœ‰ç´¢å¼•ä¸è®¾ç½®å‰¯æœ¬ { \"order\": 0, \"index_patterns\": [ \"*\" ], \"settings\": { \"index\": { \"number_of_shards\": \"2\", \"number_of_replicas\": \"0\" } }, \"mappings\": {}, \"aliases\": {} } 1.1. åˆ›å»ºç´¢å¼• PUT elasticsearch_study_index { \"aliases\": {}, \"settings\": { \"index\": { \"number_of_shards\": \"2\", \"number_of_replicas\": \"0\" } }, \"mappings\": { \"_doc\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"whitespace\" }, \"author\":{ \"type\": \"keyword\", \"ignore_above\": 256 }, \"content\": { \"type\": \"text\", \"fields\": { \"space\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } }, \"descripe\": { \"type\": \"text\", \"analyzer\": \"standard\" } } } } } 1.2. æ’å…¥ä¸€æ¡æ•°æ® POST elasticsearch_study_index/_doc/1 { \"title\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼Œæ¢ç´¢æœªæ¥æ•™è‚²æ–°æ¨¡å¼çš„ç§‘æŠ€æ•™è‚²å…¬å¸ã€‚\" } 1.3. å¯¹æ•°æ®è¿›è¡Œæœç´¢ #æœç´¢ä¸åˆ°æ•°æ® GET elasticsearch_study_index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœª\" } } } # èƒ½å¤Ÿæœç´¢æ•°æ® GET elasticsearch_study_index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥\" } } } æŸ¥çœ‹whitespaceåˆ†è¯ç»“æœ POST elasticsearch_study_index/_analyze { \"analyzer\": \"whitespace\", \"text\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼Œæ¢ç´¢æœªæ¥æ•™è‚²æ–°æ¨¡å¼çš„ç§‘æŠ€æ•™è‚²å…¬å¸ã€‚\" } Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part01/":{"url":"first/part01/","title":"æœç´¢çš„æœ¬è´¨","keywords":"","body":"1. æœç´¢çš„æœ¬è´¨1. æœç´¢çš„æœ¬è´¨ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part02/":{"url":"first/part02/","title":"Elasticsearch","keywords":"","body":"1. Elasticsearch1. Elasticsearch Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part02/analyzer_example.html":{"url":"first/part02/analyzer_example.html","title":"åˆ†è¯å™¨","keywords":"","body":"1. åˆ†è¯å™¨1.1. è‡ªå®šä¹‰åˆ†è¯1. åˆ†è¯å™¨ 1.1. è‡ªå®šä¹‰åˆ†è¯ PUT elasticsearch-analyzer-index { \"settings\": { \"analysis\": { \"analyzer\": { \"my_custom_analyzer\": { \"type\": \"custom\", \"char_filter\": [ \"emoticons\" , \"html_strip\" ], \"tokenizer\": \"punctuation\", \"filter\": [ \"lowercase\", \"english_stop\", \"asciifolding\" ] } }, \"tokenizer\": { \"punctuation\": { \"type\": \"pattern\", \"pattern\": \"[ .,!?ã€‚]\" } }, \"char_filter\": { \"emoticons\": { \"type\": \"mapping\", \"mappings\": [ \":) => _happy_\", \":( => _sad_\", \"ğŸ‚ => ç‰›\" ] } }, \"filter\": { \"english_stop\": { \"type\": \"stop\", \"stopwords\": \"_english_\" } } } }, \"mappings\": { \"_doc\": { \"properties\": { \"title\": { \"type\": \"text\", \"analyzer\": \"my_custom_analyzer\", \"search_analyzer\": \"my_custom_analyzer\" }, \"author\":{ \"type\": \"keyword\", \"ignore_above\": 256 }, \"content\": { \"type\": \"text\", \"fields\": { \"space\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } }, \"descripe\": { \"type\": \"text\", \"analyzer\": \"standard\" } } } } } æ£€æµ‹åˆ†è¯ç»“æœ POST elasticsearch-analyzer-index/_analyze { \"analyzer\": \"my_custom_analyzer\", \"text\": \"I'm a :) person, and you?å¥½æœªæ¥ğŸ‚\" } POST elasticsearch-analyzer-index/_analyze { \"analyzer\": \"my_custom_analyzer\", \"text\": \"Is this dÃ©jÃ  vu?\" } å“åº”ç»“å¦‚ä¸‹ { \"tokens\": [ { \"token\": \"i'm\", \"start_offset\": 0, \"end_offset\": 3, \"type\": \"word\", \"position\": 0 }, { \"token\": \"_happy_\", \"start_offset\": 6, \"end_offset\": 8, \"type\": \"word\", \"position\": 2 }, { \"token\": \"person\", \"start_offset\": 9, \"end_offset\": 15, \"type\": \"word\", \"position\": 3 }, { \"token\": \"you\", \"start_offset\": 21, \"end_offset\": 24, \"type\": \"word\", \"position\": 5 }, { \"token\": \"\"\" å¥½æœªæ¥ç‰› \"\"\", \"start_offset\": 25, \"end_offset\": 37, \"type\": \"word\", \"position\": 6 } ] } æ’å…¥æ•°æ® POST elasticsearch-analyzer-index/_doc/1 { \"title\": \"å¥½æœªæ¥ æ˜¯ä¸€ä¸ªä»¥æ™ºæ…§æ•™è‚²å’Œå¼€æ”¾å¹³å°ä¸ºä¸»ä½“ï¼ŒI'm a :) person, and you?å¥½æœªæ¥ğŸ‚ã€‚\" } POST elasticsearch-analyzer-index/_doc/_bulk?refresh {\"index\":{}} {\"author\":\"æå››1\" ,\"title\": \"å¥½æœªæ¥æ˜¯ ä¸€ä¸ª ä»¥ æ™ºæ…§æ•™è‚² å’Œ å¼€æ”¾å¹³å° ä¸º ä¸»ä½“ã€‚å¥½æœªæ¥ğŸ‚\"} {\"index\":{}} {\"author\":\"æå››2\" ,\"title\": \"å¥½æœªæ¥ æ˜¯ ä¸€ä¸ª ä»¥ æ™ºæ…§æ•™è‚²å’Œ å¼€æ”¾å¹³å° ä¸º ä¸»ä½“ï¼Œæ¢ç´¢ æœªæ¥ æ•™è‚² æ–°æ¨¡å¼ çš„ ç§‘æŠ€æ•™è‚² å…¬å¸ã€‚\"} æœç´¢ POST elasticsearch-analyzer-index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥ç‰›\" } } } POST elasticsearch-analyzer-index/_search { \"query\": { \"match\": { \"title\": \"å¥½æœªæ¥\" } } } å®˜æ–¹æ–‡æ¡£analysis Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part02/basic_concept.html":{"url":"first/part02/basic_concept.html","title":"åŸºæœ¬æ¦‚å¿µ","keywords":"","body":"1. ElasticsearchåŸºæœ¬æ¦‚å¿µ1.1. é›†ç¾¤ï¼ˆclusterï¼‰1.2. èŠ‚ç‚¹ï¼ˆnodeï¼‰1.3. ç´¢å¼•ï¼ˆindexï¼‰1.4. ç±»å‹ï¼ˆtypeï¼‰1.5. æ–‡æ¡£ï¼ˆdocumentï¼‰1.6. å­—æ®µï¼ˆfieldï¼‰1.7. æ˜ å°„ï¼ˆmappingï¼‰1.8. åˆ†ç‰‡ï¼ˆshardsï¼‰1.9. æ®µï¼ˆsegementsï¼‰1. ElasticsearchåŸºæœ¬æ¦‚å¿µ 1.1. é›†ç¾¤ï¼ˆclusterï¼‰ â€ƒâ€ƒ ä¸€ä¸ªElasticsearché›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªESèŠ‚ç‚¹ç»„æˆï¼Œå¹¶æä¾›é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢èƒ½åŠ›ï¼ˆæ‰€æœ‰èŠ‚ç‚¹å…±åŒå­˜å‚¨æ•°æ®ï¼‰ã€‚â€ƒâ€ƒ ä¸€ä¸ªé›†ç¾¤è¢«å‘½åä¸ºå”¯ä¸€çš„åå­—ï¼ˆé»˜è®¤ä¸ºelasticsearchï¼‰ï¼Œé›†ç¾¤åç§°éå¸¸é‡è¦ï¼Œå› ä¸ºèŠ‚ç‚¹éœ€è¦é€šè¿‡é›†ç¾¤çš„åç§°åŠ å…¥é›†ç¾¤ã€‚é›†ç¾¤çš„çš„çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼šgreen,yellow,redgreenâ€ƒâ€ƒé›†ç¾¤æ‰€æœ‰ç´¢å¼•çš„åˆ†ç‰‡ï¼ˆshardï¼‰éƒ½è¢«æ­£å¸¸çš„åˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼›yellowâ€ƒâ€ƒé›†ç¾¤ä¸­æœ‰ç´¢å¼•å­˜åœ¨å‰¯æœ¬åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼›redâ€ƒâ€ƒé›†ç¾¤ä¸­æœ‰ç´¢å¼•å­˜åœ¨ä¸»åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼› æŸ¥çœ‹é›†ç¾¤å¥åº·ä¿¡æ¯ GET _cluster/health?pretty GET _cat/health?format=json 1.2. èŠ‚ç‚¹ï¼ˆnodeï¼‰ â€ƒâ€ƒä¸€ä¸ªèŠ‚ç‚¹æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®å¹¶å‚ä¸é›†ç¾¤çš„ç´¢å¼•å’Œæœç´¢ã€‚å’Œé›†ç¾¤ç±»ä¼¼ï¼ŒèŠ‚ç‚¹ç”±ä¸€ä¸ªåç§°æ¥æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åç§°æ˜¯åœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶åˆ†é…ç»™èŠ‚ç‚¹çš„éšæœºé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ã€‚æ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä»»æ„èŠ‚ç‚¹çš„åç§°ï¼ŒèŠ‚ç‚¹åç§°å¯¹äºç®¡ç†å·¥ä½œå¾ˆé‡è¦ï¼Œ å› ä¸ºé€šè¿‡èŠ‚ç‚¹åç§°å¯ä»¥ç¡®å®šç½‘ç»œä¸­çš„å“ªäº›æœåŠ¡å™¨å¯¹åº”äºElasticsearché›†ç¾¤ä¸­çš„å“ªäº›èŠ‚ç‚¹ã€‚â€ƒâ€ƒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥è¢«æ·»åŠ åˆ°æŒ‡å®šåç§°çš„é›†ç¾¤ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šè¢«è®¾ç½®åŠ å…¥åˆ°åç§°ä¸ºelasticsearchçš„é›†ç¾¤ä¸­ï¼Œ è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨æ‚¨åœ¨ç½‘ç»œä¸­å¯åŠ¨äº†æŸäº›èŠ‚ç‚¹ï¼ˆå‡è®¾è¿™äº›èŠ‚ç‚¹å¯ä»¥å‘ç°å½¼æ­¤ï¼‰ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨å½¢æˆå¹¶åŠ å…¥åç§°ä¸ºelasticsearchçš„é›†ç¾¤ä¸­ã€‚â€ƒâ€ƒä¸€ä¸ªé›†ç¾¤å¯ä»¥æ‹¥æœ‰ä»»æ„å¤šçš„èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨æ‚¨çš„ç½‘ç»œä¸­æ²¡æœ‰è¿è¡Œä»»ä½•ElasticsearchèŠ‚ç‚¹ï¼Œ æ­¤æ—¶å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªåç§°ä¸ºelasticsearchçš„å•èŠ‚ç‚¹é›†ç¾¤ã€‚ èŠ‚ç‚¹çš„è§’è‰²å¯ä»¥ï¼Œç”±ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°æ¥å†³å®šï¼Œä¸åŒè§’è‰²ï¼Œå¯ä»¥ä¸“æ³¨äºå®Œæˆä¸åŒçš„äº‹ï¼š node.master: true node.data: true node.ingestï¼štrue Master Node(ä¸“æœ‰ä¸»èŠ‚ç‚¹)å¦‚æœèŠ‚ç‚¹ä¸ºä»¥ä¸‹é…ç½®ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸ºä¸“æœ‰å€™é€‰ä¸»èŠ‚ç‚¹ï¼›å¦‚æœé€‰ä¸¾æˆåŠŸï¼Œåˆ™è¯¥èŠ‚ç‚¹æˆä¸ºmaster,masterèŠ‚ç‚¹ä¸€èˆ¬ä¸ç”¨äºå’Œåº”ç”¨åˆ›å»ºè¿æ¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜äº†é›†ç¾¤çŠ¶æ€ï¼ŒmasterèŠ‚ç‚¹ä¸å ç”¨ç£ç›˜IOå’ŒCPUï¼Œå†…å­˜ä½¿ç”¨é‡ä¸€èˆ¬ã€‚å…¶ä»–æ²¡æœ‰é€‰ä¸¾æˆä¸ºmasterèŠ‚ç‚¹çš„ï¼Œä»ç„¶ä¿æŒå€™é€‰ä¸»èŠ‚ç‚¹çš„èº«ä»½ï¼Œéœ€è¦å’Œå ç”¨çš„èµ„æºæ¯”masterèŠ‚ç‚¹æ›´å°‘ã€‚ # å…·æœ‰èµ„æ ¼é€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹çš„ï¼Œå€™é€‰èŠ‚ç‚¹ node.master: true node.data: false node.ingestï¼šfalse masterèŠ‚ç‚¹æ§åˆ¶æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®ã€‚åªæœ‰Master NodeèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯åŠå…ƒæ•°æ®(metadata)çš„å¤„ç†ï¼Œ æ¯”å¦‚ç´¢å¼•çš„æ–°å¢ã€åˆ é™¤ã€åˆ†ç‰‡è·¯ç”±åˆ†é…ã€æ‰€æœ‰ç´¢å¼•å’Œç›¸å…³ Mapping ã€Setting é…ç½®ç­‰ç­‰ã€‚ å€™é€‰èŠ‚ç‚¹ï¼šä¸é›†ç¾¤ä¿æŒå¿ƒè·³ï¼Œåˆ¤æ–­Masteræ˜¯å¦å­˜æ´»ï¼Œå¦‚æœMasteræ•…éšœåˆ™å‚åŠ æ–°ä¸€è½®çš„Masteré€‰ä¸¾ é›†ç¾¤è§„åˆ’ ï¼š Elasticsearché›†ç¾¤å»ºè®®masterè‡³å°‘ä¸‰å°(ç”Ÿäº§å»ºè®®æ¯ä¸ªeså®ä¾‹éƒ¨ç½²åœ¨ä¸åŒçš„è®¾å¤‡ä¸Š)ï¼Œä¸‰ä¸ªMasterèŠ‚ç‚¹æœ€å¤šåªèƒ½æ•…éšœä¸€å°MasterèŠ‚ç‚¹ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¦‚æœä¸‰ä¸ªèŠ‚ç‚¹æ•…éšœä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆ™é€ æˆæ•°æ®ä¸¢å¤±å¹¶æ— æ³•ç»„æˆé›†ç¾¤ã€‚ Data Node(ä¸“æœ‰æ•°æ®èŠ‚ç‚¹)æ•°æ®èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å’Œç´¢å¼•åº”ç”¨åˆ›å»ºè¿æ¥ã€æ¥æ”¶ç´¢å¼•è¯·æ±‚ï¼Œè¯¥èŠ‚ç‚¹çœŸæ­£å­˜å‚¨æ•°æ®ï¼ŒESé›†ç¾¤çš„æ€§èƒ½å–å†³äºè¯¥èŠ‚ç‚¹çš„ä¸ªæ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€ä¼˜é…ç½®çš„æƒ…å†µä¸‹ï¼‰ï¼ŒdataèŠ‚ç‚¹ä¼šå ç”¨å¤§é‡çš„CPUã€IOå’Œå†…å­˜ã€‚ dataèŠ‚ç‚¹çš„åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥è·å¾—æŸ¥è¯¢ç»“æœåå°†ç»“æœåé¦ˆç»™åè°ƒèŠ‚ç‚¹ï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­éå¸¸æ¶ˆè€—ç¡¬ä»¶èµ„æºï¼Œå¦‚æœåœ¨åˆ†ç‰‡é…ç½®åŠä¼˜åŒ–æ²¡åšå¥½çš„æƒ…å†µä¸‹, è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢éå¸¸ç¼“æ…¢(ç¡¬ä»¶é…ç½®ä¹Ÿè¦è·Ÿä¸Šæ•°æ®é‡)ã€‚ åœ¨Elasticsearché›†ç¾¤ä¸­ï¼Œæ­¤èŠ‚ç‚¹åº”è¯¥æ˜¯æœ€å¤šçš„ï¼Œå•ä¸ªç´¢å¼•åœ¨ä¸€ä¸ªdataèŠ‚ç‚¹å®ä¾‹ä¸Šåˆ†ç‰‡æ•°ä¿æŒåœ¨3ä¸ªä»¥å†…(å»ºè®®åˆ†ç‰‡æ•°é‡æŒ‰ç…§DataèŠ‚ç‚¹æ•°é‡åˆ’åˆ†æ¯”è¾ƒå¥½ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸€ä¸ªåˆ†ç‰‡)ï¼›æ¯1GBå †å†…å­˜å¯¹åº”é›†ç¾¤çš„åˆ†ç‰‡ä¿æŒåœ¨20ä¸ªä»¥å†…ï¼›æ¯ä¸ªåˆ†ç‰‡å¤§å°ä¸è¦è¶…è¿‡30Gï¼Œçº¯æœç´¢å‹å»ºè®®ä¸è¶…è¿‡10GBï¼Œæ—¥å¿—å‹å»ºè®®30GB-50GBã€‚ node.master: false node.data: true node.ingestï¼šfalse å†…å­˜å»ºè®®: å‡å¦‚ä¸€å°æœºå™¨éƒ¨ç½²äº†ä¸€ä¸ªESå®ä¾‹ï¼Œåˆ™ESæœ€å¤§å¯ç”¨å†…å­˜ç»™åˆ°ç‰©ç†å†…å­˜çš„50%ï¼Œæœ€å¤šä¸å¯è¶…è¿‡32Gï¼ˆå¦‚æœè¶…è¿‡32GBï¼Œjvmå°†ä¼šä½¿ç”¨é•¿æŒ‡é’ˆï¼Œå®˜æ–¹å»ºè®®å †å†…å­˜åˆ†é…ä¸º26-32GBï¼‰ã€‚ å¦‚æœå•å°æœºå™¨ä¸Šéƒ¨ç½²äº†å¤šä¸ªESå®ä¾‹ï¼Œåˆ™å¤šä¸ªESå®ä¾‹å†…å­˜ç›¸åŠ ç­‰äºç‰©ç†å†…å­˜çš„50%ï¼Œå¤šä¸ªESå®ä¾‹å†…å­˜ç›¸åŠ ä¸å®œè¶…è¿‡32Gã€‚ åˆ†ç‰‡å»ºè®®ï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼‰ï¼šå¦‚æœå•ä¸ªåˆ†ç‰‡æ¯ä¸ªèŠ‚ç‚¹å¯æ”¯æ’‘90Gæ•°æ®ï¼Œä¾æ­¤å¯è®¡ç®—å‡ºæ‰€éœ€dataèŠ‚ç‚¹æ•°ã€‚å¦‚æœå¤šä¸ªåˆ†ç‰‡æŒ‰ç…§å•ä¸ªdataèŠ‚ç‚¹jvmå†…å­˜æœ€å¤§30Gæ¥è®¡ç®—ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†ç‰‡ä¿æŒåœ¨600ä¸ªä»¥å†…ï¼Œå­˜å‚¨ä¿æŒåœ¨18Tä»¥å†…ã€‚ Ingest Node(ä¸“æœ‰æ•°æ®é¢„å¤„ç†èŠ‚ç‚¹)ingest èŠ‚ç‚¹å¯ä»¥çœ‹ä½œæ˜¯æ•°æ®å‰ç½®å¤„ç†è½¬æ¢çš„èŠ‚ç‚¹ï¼Œæ”¯æŒ pipelineç®¡é“ è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ ingest å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç±»ä¼¼äº logstash ä¸­ filter çš„ä½œç”¨ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ã€‚ IngestèŠ‚ç‚¹å¤„ç†æ—¶æœºâ€”â€”åœ¨æ•°æ®è¢«ç´¢å¼•ä¹‹å‰ï¼Œé€šè¿‡é¢„å®šä¹‰å¥½çš„å¤„ç†ç®¡é“å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ç”¨Ingestï¼Œå› æ­¤ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥å¤„ç†Ingestä»»åŠ¡ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºä¸“ç”¨çš„IngestèŠ‚ç‚¹ã€‚ é€šå¸¸æ•°æ®çš„åŠ å·¥å»ºè®®ï¼Œæ”¾åœ¨ä¸“æœ‰çš„æ•°æ® ETLç»„ä»¶ä¸­ node.master: false node.data: false node.ingestï¼štrue Coordinating Node(ä¸“æœ‰åè°ƒèŠ‚ç‚¹)åè°ƒèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å’Œæ£€ç´¢åº”ç”¨åˆ›å»ºè¿æ¥ã€æ¥å—æ£€ç´¢è¯·æ±‚ï¼Œä½†å…¶æœ¬èº«ä¸è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œå¯å½“è´Ÿè´£å‡è¡¡èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸å ç”¨ioã€cpuå’Œå†…å­˜ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸åˆç†çš„èšåˆæŸ¥è¯¢ï¼Œä¹Ÿä¼šå¯¼è‡´åè°ƒèŠ‚ç‚¹oomã€‚ åè°ƒèŠ‚ç‚¹æ¥å—å®¢æˆ·ç«¯æœç´¢è¯·æ±‚åå°†è¯·æ±‚è½¬å‘åˆ°ä¸æŸ¥è¯¢æ¡ä»¶ç›¸å…³çš„å¤šä¸ªdataèŠ‚ç‚¹çš„åˆ†ç‰‡ä¸Šï¼Œç„¶åå¤šä¸ªdataèŠ‚ç‚¹çš„åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æˆ–è€…æŸ¥è¯¢ç»“æœå†è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹æŠŠå„ä¸ªdataèŠ‚ç‚¹çš„è¿”å›ç»“æœè¿›è¡Œæ•´åˆã€æ’åºç­‰ä¸€ç³»åˆ—æ“ä½œåå†å°†æœ€ç»ˆç»“æœè¿”å›ç»™ç”¨æˆ·è¯·æ±‚ å¢åŠ åè°ƒèŠ‚ç‚¹å¯å¢åŠ æ£€ç´¢å¹¶å‘,ä½†æ£€ç´¢çš„é€Ÿåº¦è¿˜æ˜¯å–å†³äºæŸ¥è¯¢æ‰€å‘½ä¸­çš„åˆ†ç‰‡ä¸ªæ•°ä»¥åŠåˆ†ç‰‡ä¸­çš„æ•°æ®é‡ node.master: false node.data: false node.ingestï¼šfalse æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ GET _cat/nodes?v&format=txt 1.3. ç´¢å¼•ï¼ˆindexï¼‰ â€ƒâ€ƒä¸€ä¸ªç´¢å¼•æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€äº›ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£çš„é›†åˆï¼ˆç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®åº“ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå®¢æˆ·æ•°æ®çš„ç´¢å¼•ï¼Œä»¥åŠä¸€ä¸ªè®¢å•æ•°æ®çš„ç´¢å¼•ã€‚ ä¸€ä¸ªç´¢å¼•é€šå¸¸ä½¿ç”¨ä¸€ä¸ªåç§°ï¼ˆæ‰€æœ‰å­—æ¯å¿…é¡»å°å†™ï¼‰æ¥æ ‡è¯†ï¼Œ å½“é’ˆå¯¹è¿™ä¸ªç´¢å¼•çš„æ–‡æ¡£æ‰§è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œè¿™ä¸ªåç§°è¢«ç”¨æ¥æŒ‡å‘ç´¢å¼•ã€‚ è¡¨ 1-1 Elasticsearchä¸å…³ç³»å‹æ•°æ®åº“çš„å¯¹åº”å…³ç³» Elasticsearch å…³ç³»å‹æ•°æ®åº“ ç´¢å¼•ï¼ˆindexï¼‰ HTTPæ–¹æ³•ï¼ŒåŒ…æ‹¬GETã€POSTã€PUTã€HEADã€DELETEã€‚ æ–‡æ¡£ç±»å‹ï¼ˆtypeï¼‰ï¼Œes6ç‰ˆæœ¬ä¹‹åä¸€ä¸ªindexåªèƒ½æœ‰ä¸€ä¸ªtype æ•°æ®åº“ï¼ˆDatabaseï¼‰ æ–‡æ¡£ï¼ˆdocumentï¼‰ ä¸€è¡Œæ•°æ®ï¼ˆRowï¼‰ å­—æ®µï¼ˆfieldï¼‰ ä¸€åˆ—æ•°æ®ï¼ˆColumnï¼‰ æ˜ å°„ï¼ˆmappingï¼‰ æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ â€ƒâ€ƒåœ¨Elasticsearchä¸­ç´¢å¼•ä¸€è¯ï¼Œæœ‰å¤šç§å«ä¹‰ï¼š Index Versus â€ƒâ€ƒä½ ä¹Ÿè®¸å·²ç»æ³¨æ„åˆ° ç´¢å¼• è¿™ä¸ªè¯åœ¨ Elasticsearch è¯­å¢ƒä¸­æœ‰å¤šç§å«ä¹‰ï¼Œ è¿™é‡Œæœ‰å¿…è¦åšä¸€äº›è¯´æ˜ï¼š ç´¢å¼•ï¼ˆåè¯ï¼‰ï¼šâ€ƒâ€ƒå¦‚å‰æ‰€è¿°ï¼Œä¸€ä¸ª ç´¢å¼• ç±»ä¼¼äºä¼ ç»Ÿå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€ä¸ª æ•°æ®åº“ ï¼Œæ˜¯ä¸€ä¸ªå­˜å‚¨å…³ç³»å‹æ–‡æ¡£çš„åœ°æ–¹ã€‚ ç´¢å¼• (index) çš„å¤æ•°è¯ä¸º indices æˆ– indexes ã€‚ ç´¢å¼•ï¼ˆåŠ¨è¯ï¼‰ï¼šâ€ƒâ€ƒç´¢å¼•ä¸€ä¸ªæ–‡æ¡£ å°±æ˜¯å­˜å‚¨ä¸€ä¸ªæ–‡æ¡£åˆ°ä¸€ä¸ª ç´¢å¼• ï¼ˆåè¯ï¼‰ä¸­ä»¥ä¾¿è¢«æ£€ç´¢å’ŒæŸ¥è¯¢ã€‚ è¿™éå¸¸ç±»ä¼¼äº SQL è¯­å¥ä¸­çš„ INSERT å…³é”®è¯ï¼Œé™¤äº†æ–‡æ¡£å·²å­˜åœ¨æ—¶ï¼Œæ–°æ–‡æ¡£ä¼šæ›¿æ¢æ—§æ–‡æ¡£æƒ…å†µä¹‹å¤–ã€‚ å€’æ’ç´¢å¼•ï¼šâ€ƒâ€ƒå…³ç³»å‹æ•°æ®åº“é€šè¿‡å¢åŠ ä¸€ä¸ª ç´¢å¼• æ¯”å¦‚ä¸€ä¸ª Bæ ‘ï¼ˆB-treeï¼‰ç´¢å¼• åˆ°æŒ‡å®šçš„åˆ—ä¸Šï¼Œ ä»¥ä¾¿æå‡æ•°æ®æ£€ç´¢é€Ÿåº¦ã€‚Elasticsearch å’Œ Lucene ä½¿ç”¨äº†ä¸€ä¸ªå«åš å€’æ’ç´¢å¼• çš„ç»“æ„æ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ â€ƒâ€ƒé»˜è®¤çš„ï¼Œä¸€ä¸ªæ–‡æ¡£ä¸­çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æ˜¯ è¢«ç´¢å¼• çš„ï¼ˆæœ‰ä¸€ä¸ªå€’æ’ç´¢å¼•ï¼‰å’Œå¯æœç´¢çš„ã€‚ ä¸€ä¸ªæ²¡æœ‰å€’æ’ç´¢å¼•çš„å±æ€§æ˜¯ä¸èƒ½è¢«æœç´¢åˆ°çš„ã€‚ ç´¢å¼•çš„çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼šgreen,yellow,redgreenâ€ƒâ€ƒç´¢å¼•çš„åˆ†ç‰‡ï¼ˆshardï¼‰éƒ½è¢«æ­£å¸¸çš„åˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼›yellowâ€ƒâ€ƒç´¢å¼•å­˜åœ¨å‰¯æœ¬åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼›redâ€ƒâ€ƒç´¢å¼•å­˜åœ¨ä¸»åˆ†ç‰‡ï¼ˆshardï¼‰æ²¡æœ‰è¢«åˆ†é…ï¼› æŸ¥çœ‹ç´¢å¼•è¡¨çš„çŠ¶æ€ GET _cat/indices?health=green GET _cat/indices/elasticsearch-analyzer-index?health=green æŸ¥çœ‹ç´¢å¼•çš„å®šä¹‰ä¿¡æ¯ GET elasticsearch-analyzer-index GET elasticsearch-analyzer-index?flat_settings&include_defaults å“åº”è¿”å› \"elasticsearch-analyzer-index\": { \"aliases\": { \"elasticsearch-analyzer-index-alias\": {} }, \"mappings\": { \"_doc\": { \"properties\": { \"author\": { \"type\": \"keyword\", \"ignore_above\": 256 }, \"content\": { \"type\": \"text\", \"fields\": { \"space\": { \"type\": \"text\", \"analyzer\": \"whitespace\" } } }, \"descripe\": { \"type\": \"text\", \"analyzer\": \"standard\" }, \"title\": { \"type\": \"text\", \"analyzer\": \"my_custom_analyzer\" } } } }, \"settings\": { \"index\": { \"number_of_shards\": \"1\", \"provided_name\": \"elasticsearch-analyzer-index\", \"creation_date\": \"1622366213571\", \"analysis\": { \"filter\": { \"english_stop\": { \"type\": \"stop\", \"stopwords\": \"_english_\" } }, \"char_filter\": { \"emoticons\": { \"type\": \"mapping\", \"mappings\": [ \":) => _happy_\", \":( => _sad_\", \"ğŸ‚ => ç‰›\" ] } }, \"analyzer\": { \"my_custom_analyzer\": { \"filter\": [ \"lowercase\", \"english_stop\", \"asciifolding\" ], \"char_filter\": [ \"emoticons\", \"html_strip\" ], \"type\": \"custom\", \"tokenizer\": \"punctuation\" } }, \"tokenizer\": { \"punctuation\": { \"pattern\": \"[ .,!?ã€‚]\", \"type\": \"pattern\" } } }, \"number_of_replicas\": \"0\", \"uuid\": \"vQ2TkUx3SNCGjBuJZ6AQKA\", \"version\": { \"created\": \"6040099\" } } } } 1.4. ç±»å‹ï¼ˆtypeï¼‰ â€ƒâ€ƒä¸€ä¸ªç±»å‹é€šå¸¸æ˜¯ä¸€ä¸ªç´¢å¼•çš„ä¸€ä¸ªé€»è¾‘åˆ†ç±»æˆ–åˆ†åŒºï¼Œå…è®¸åœ¨ä¸€ä¸ªç´¢å¼•ä¸‹å­˜å‚¨ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼‰ ï¼Œä¾‹å¦‚ç”¨æˆ·ç±»å‹ã€è®¢å•ç±»å‹ç­‰ã€‚ç›®å‰å·²ç»ä¸æ”¯æŒåœ¨ä¸€ä¸ªç´¢å¼•ä¸‹åˆ›å»ºå¤šä¸ªç±»å‹ï¼Œå¹¶ä¸”ç±»å‹æ¦‚å¿µå·²ç»åœ¨åç»­ç‰ˆæœ¬ä¸­åˆ é™¤ï¼Œ è¯¦æƒ…è¯·å‚è§Elasticsearchå®˜æ–¹æ–‡æ¡£ã€‚ 1.5. æ–‡æ¡£ï¼ˆdocumentï¼‰ â€ƒâ€ƒElasticsearch æ˜¯ é¢å‘æ–‡æ¡£ çš„ï¼Œæ„å‘³ç€å®ƒå­˜å‚¨æ•´ä¸ªå¯¹è±¡æˆ– æ–‡æ¡£ã€‚Elasticsearch ä¸ä»…å­˜å‚¨æ–‡æ¡£ï¼Œ è€Œä¸” ç´¢å¼• æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ï¼Œ ä½¿ä¹‹å¯ä»¥è¢«æ£€ç´¢ã€‚åœ¨ Elasticsearch ä¸­ï¼Œæˆ‘ä»¬å¯¹æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æ£€ç´¢ã€æ’åºå’Œè¿‡æ»¤â€”â€‹è€Œä¸æ˜¯å¯¹è¡Œåˆ—æ•°æ®ã€‚ è¿™æ˜¯ä¸€ç§å®Œå…¨ä¸åŒçš„æ€è€ƒæ•°æ®çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ Elasticsearch èƒ½æ”¯æŒå¤æ‚å…¨æ–‡æ£€ç´¢çš„åŸå› ã€‚ å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ–‡æ¡£çš„idï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥ç›´æ¥æ”¹æ–‡æ¡£ GET elasticsearch_study_index/_doc/1 1.6. å­—æ®µï¼ˆfieldï¼‰ â€ƒâ€ƒç»„æˆæ–‡æ¡£çš„æœ€å°å•ä½ã€‚ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€åˆ—æ•°æ®ã€‚ 1.7. æ˜ å°„ï¼ˆmappingï¼‰ â€ƒâ€ƒç”¨æ¥å®šä¹‰ä¸€ä¸ªæ–‡æ¡£ä»¥åŠå…¶æ‰€åŒ…å«çš„å­—æ®µå¦‚ä½•è¢«å­˜å‚¨å’Œç´¢å¼•ï¼Œ ä¾‹å¦‚åœ¨mappingä¸­å®šä¹‰å­—æ®µçš„åç§°å’Œç±»å‹ï¼Œä»¥åŠæ‰€ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„Schemaã€‚ 1.8. åˆ†ç‰‡ï¼ˆshardsï¼‰ â€ƒâ€ƒä»£è¡¨ç´¢å¼•åˆ†ç‰‡ï¼ŒElasticsearchå¯ä»¥æŠŠä¸€ä¸ªå®Œæ•´çš„ç´¢å¼•åˆ†æˆå¤šä¸ªåˆ†ç‰‡,å³ä¸€ä¸ªç´¢å¼•è¡¨å…¶å®æ˜¯ä¸€ç»„shardçš„é€»è¾‘è§†å›¾ï¼Œ è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æŠŠä¸€ä¸ªå¤§çš„ç´¢å¼•æ‹†åˆ†æˆå¤šä¸ªï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ„æˆåˆ†å¸ƒå¼æœç´¢ã€‚ åˆ†ç‰‡çš„æ•°é‡åªèƒ½åœ¨ç´¢å¼•åˆ›å»ºå‰æŒ‡å®šï¼Œå¹¶ä¸”ç´¢å¼•åˆ›å»ºåä¸èƒ½æ›´æ”¹ã€‚ 1.9. æ®µï¼ˆsegementsï¼‰ æ¯ä¸ªshardåˆ†ç‰‡æ˜¯ä¸€ä¸ªluceneå®ä¾‹ï¼Œæ¯ä¸ªåˆ†ç‰‡ç”±å¤šä¸ªsegmentç»„æˆã€‚æ¯ä¸ªsegmentå ç”¨å†…å­˜ï¼Œæ–‡ä»¶å¥æŸ„ç­‰ã€‚æœåŠ¡å™¨æ€»å†…å­˜é™¤äº†åˆ†é…jvmé…ç½®çš„ï¼Œå…¶ä½™éƒ½ç»™äº†luceneï¼Œå ç”¨page cacheå†…å­˜ï¼Œpage cacheä¿å­˜å¯¹æ–‡ä»¶æ•°æ®segmentçš„ç¼“å­˜ã€‚free -gå¯æŸ¥çœ‹å†…å­˜ä½¿ç”¨ï¼ŒesèŠ‚ç‚¹åªæœ‰esæœåŠ¡ï¼ŒåŸºæœ¬cacheå°±æ˜¯ç¼“å­˜çš„segmentã€‚ å¤šä¸ªæ®µå¯ä»¥åˆå¹¶ï¼Œå‡å°‘ç£ç›˜çš„ioã€‚luceneçš„æ•°æ®å†™å…¥ä¼šå…ˆå†™å¦‚åˆ°ç¼“å­˜ï¼ˆbufferï¼‰ä¸­ï¼Œå½“è¾¾åˆ°ä¸€å®šæ•°é‡ä»¥åï¼Œä¼šflushæˆæ–‡ä¸€ä¸ªsegmentï¼Œå†™å…¥åˆ°ç£ç›˜å½“ä¸­ã€‚æ¯ä¸ªsegementæœ‰è‡ªå·±ç‹¬ç«‹çš„ç´¢å¼•ï¼Œå¯ä»¥å•ç‹¬æŸ¥è¯¢ã€‚segmentä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ•°æ®çš„çš„å†™å…¥éƒ½æ˜¯è¿›è¡Œæ‰¹é‡çš„è¿½åŠ ï¼Œé¿å…äº†éšæœºå†™çš„å­˜åœ¨ï¼Œæé«˜äº†ååé‡ã€‚segementå¯ä»¥è¢«åˆ é™¤ï¼Œä½†ä¹Ÿä¸æ˜¯ä¿®æ”¹segementæ–‡ä»¶ï¼Œ è€Œæ˜¯ç”±å¦å¤–çš„æ–‡ä»¶è®°å½•éœ€è¦è¢«åˆ é™¤çš„documentIdã€‚indexçš„æŸ¥è¯¢æ˜¯å¯¹å¤šä¸ªsegementæ–‡ä»¶çš„æŸ¥è¯¢ï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº†å¤„ç†è¢«åˆ é™¤æ–‡ä»¶çš„å¤„ç†ï¼Œå¹¶å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆå¹¶ã€‚ä¸ºäº†è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œluceneæœ‰ç­–ç•¥å¯¹å¤šä¸ªsegmentè¿›è¡Œä¼˜åŒ–ã€‚ #æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰ç´¢å¼•segementsçš„æƒ…å†µ GET _cat/segments?v #æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹segementså ç”¨çš„å †å†…å­˜ GET _cat/nodes?v&h=ip,ram.percent,sm #æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„segementsçš„æƒ…å†µ GET _cat/segments/elasticsearch_study_index?v Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part02/elasticsearch_lucene_segments.html":{"url":"first/part02/elasticsearch_lucene_segments.html","title":"Elasticsearchã€Luceneã€Segments","keywords":"","body":"1. Elasticsearchã€Luceneã€Segments1.1. refresh1.2. segments1.3. translog1. Elasticsearchã€Luceneã€Segments åˆ†ç‰‡å†…éƒ¨åŸç† 1.1. refresh é»˜è®¤å€¼ä¸º1ç§’ï¼Œå³æ•°æ®å†™å…¥ESå1så¯è§ã€‚ \"index.refresh_interval\": \"1s\" å¦‚æœå¯¹æ•°æ®çš„å®æ—¶è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ refreshçš„é¢‘ç‡ï¼Œä½¿indexBufferä¸­çš„æ•°æ®ç§¯ç´¯çš„è¾ƒå¤šçš„æ—¶å€™ï¼Œå½¢æˆå¤§çš„æ®µï¼ˆsegmentï¼‰ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¤§é‡å°æ®µåˆå¹¶ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚ 1.2. segments æ®µåˆå¹¶æ˜¯ä¸€é¡¹æ¯”è¾ƒé‡çš„æ“ä½œï¼Œä¼šæ¶ˆè€—å¤§é‡ç£ç›˜IOï¼›å¯ä»¥é™åˆ¶æ¯ä¸ªç´¢å¼•è¡¨åˆå¹¶çº¿ç¨‹æ•°ç›®ï¼Œé¿å…åœ¨å†™å…¥é«˜å³°çš„æ—¶å€™æœ‰å¤§é‡åˆå¹¶æ“ä½œï¼Œå½±å“å†™å…¥æ€§èƒ½ \"index.merge.scheduler.max_merge_count\": \"200\", \"index.merge.scheduler.max_thread_count\": \"1\", é…ç½®çš„æºç ä½ç½® org.elasticsearch.indexorg.elasticsearch.indexMergeSchedulerConfig public static final Setting MAX_THREAD_COUNT_SETTING = new Setting<>(\"index.merge.scheduler.max_thread_count\", (s) -> Integer.toString(Math.max(1, Math.min(4, EsExecutors.allocatedProcessors(s) / 2))), (s) -> Setting.parseInt(s, 1, \"index.merge.scheduler.max_thread_count\"), Property.Dynamic, Property.IndexScope); public static final Setting MAX_MERGE_COUNT_SETTING = new Setting<>(\"index.merge.scheduler.max_merge_count\", (s) -> Integer.toString(MAX_THREAD_COUNT_SETTING.get(s) + 5), (s) -> Setting.parseInt(s, 1, \"index.merge.scheduler.max_merge_count\"), Property.Dynamic, Property.IndexScope); public static final Setting AUTO_THROTTLE_SETTING = Setting.boolSetting(\"index.merge.scheduler.auto_throttle\", true, Property.Dynamic, Property.IndexScope); 1.3. translog å®˜æ–¹æ–‡æ¡£ translogä¸­çš„æ•°æ®åªæœ‰åœ¨fsyncå’Œæäº¤æ—¶æ‰ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚åœ¨ç¡¬ä»¶å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œåœ¨translogæäº¤ä¹‹å‰çš„æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœindex.translog.durabilityè¢«è®¾ç½®ä¸ºasyncçš„è¯ï¼ŒElasticsearchæ¯5ç§’é’ŸåŒæ­¥å¹¶æäº¤ä¸€æ¬¡translogã€‚ æˆ–è€…å¦‚æœè¢«è®¾ç½®ä¸ºrequestï¼ˆé»˜è®¤ï¼‰çš„è¯ï¼Œæ¯æ¬¡indexï¼Œdeleteï¼Œupdateï¼Œbulkè¯·æ±‚æ—¶å°±åŒæ­¥ä¸€æ¬¡translogã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœè®¾ç½®ä¸ºrequest, Elasticsearchåªä¼šåœ¨æˆåŠŸåœ°åœ¨ä¸»åˆ†ç‰‡å’Œæ¯ä¸ªå·²åˆ†é…çš„å‰¯æœ¬åˆ†ç‰‡ä¸Šfsyncå¹¶æäº¤translogä¹‹åï¼Œ æ‰ä¼šå‘å®¢æˆ·ç«¯æŠ¥å‘Šindexã€deleteã€updateã€bulkæˆåŠŸã€‚ å¯ä»¥åŠ¨æ€æ§åˆ¶æ¯ä¸ªç´¢å¼•çš„translogè¡Œä¸ºï¼š index.translog.sync_interval ï¼štranslogå¤šä¹…è¢«åŒæ­¥åˆ°ç£ç›˜å¹¶æäº¤ä¸€æ¬¡ã€‚é»˜è®¤5ç§’ã€‚è¿™ä¸ªå€¼ä¸èƒ½å°äº100ms index.translog.durability ï¼šæ˜¯å¦åœ¨æ¯æ¬¡indexï¼Œdeleteï¼Œupdateï¼Œbulkè¯·æ±‚ä¹‹åç«‹å³åŒæ­¥å¹¶æäº¤translogã€‚æ¥å—ä¸‹åˆ—å‚æ•°ï¼š request ï¼šï¼ˆé»˜è®¤ï¼‰fsync and commit after every requestã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœå‘ç”Ÿå´©æºƒï¼Œé‚£ä¹ˆæ‰€æœ‰åªè¦æ˜¯å·²ç»ç¡®è®¤çš„å†™æ“ä½œéƒ½å·²ç»è¢«æäº¤åˆ°ç£ç›˜ã€‚ async ï¼šåœ¨åå°æ¯sync_intervalæ—¶é—´è¿›è¡Œä¸€æ¬¡fsyncå’Œcommitã€‚æ„å‘³ç€å¦‚æœå‘ç”Ÿå´©æºƒï¼Œé‚£ä¹ˆæ‰€æœ‰åœ¨ä¸Šä¸€æ¬¡è‡ªåŠ¨æäº¤ä»¥åçš„å·²ç¡®è®¤çš„å†™æ“ä½œå°†ä¼šä¸¢å¤±ã€‚ index.translog.flush_threshold_size ï¼šå½“æ“ä½œè¾¾åˆ°å¤šå¤§æ—¶æ‰§è¡Œåˆ·æ–°ï¼Œé»˜è®¤512mbã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ“ä½œåœ¨translogä¸­ä¸æ–­ç´¯ç§¯ï¼Œå½“è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼æ—¶ï¼Œå°†ä¼šè§¦å‘åˆ·æ–°(flush)æ“ä½œã€‚ index.translog.retention.size ï¼štranslogæ–‡ä»¶è¾¾åˆ°å¤šå¤§æ—¶æ‰§è¡Œæ‰§è¡Œåˆ·æ–°ã€‚é»˜è®¤512mbã€‚ index.translog.retention.age ï¼štranslogæœ€é•¿å¤šä¹…æäº¤ä¸€æ¬¡ã€‚é»˜è®¤12hã€‚ translog-N.tlog - çœŸæ­£çš„æ—¥å¿—æ–‡ä»¶ï¼ŒNè¡¨ç¤ºgenerationï¼ˆä»£ï¼‰çš„æ„æ€ï¼Œé€šè¿‡å®ƒè·Ÿç´¢å¼•æ–‡ä»¶å…³è” tranlog.ckp - æ—¥å¿—çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œé•¿åº¦æ€»æ˜¯20ä¸ªå­—èŠ‚ï¼Œè®°å½•3ä¸ªä¿¡æ¯ï¼šåç§»é‡ & äº‹åŠ¡æ“ä½œæ•°é‡ & å½“å‰ä»£ ä¾‹å­ /elasticsearch/data/nodes/0/indices/gynPAM1CSeqeMHxAseKQSw/0/translog Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part03/":{"url":"first/part03/","title":"æ–‡æ¡£æ“ä½œ","keywords":"","body":"1. æ–‡æ¡£æ“ä½œ1. æ–‡æ¡£æ“ä½œ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part03/document_operator.html":{"url":"first/part03/document_operator.html","title":"æ–‡æ¡£æ“ä½œ","keywords":"","body":"1. æ–‡æ¡£æ“ä½œ1.1. åˆ›å»ºç´¢å¼•1.2. ç´¢å¼•æ–‡æ¡£1.3. è·å–æ–‡æ¡£1. æ–‡æ¡£æ“ä½œ 1.1. åˆ›å»ºç´¢å¼• PUT operator_document_index-2021-05-31 { \"aliases\": { \"operator_document_index-2021.05.31\": {} }, \"mappings\": { \"log\": { \"dynamic\": \"true\", \"_all\": { \"enabled\": false }, \"properties\": { \"time\": { \"type\": \"date\" }, \"price\": { \"type\": \"long\" }, \"productID\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } } } } }, \"settings\": { \"index\": { \"mapping\": { \"total_fields\": { \"limit\": \"2000000\" } }, \"refresh_interval\": \"20s\", \"indexing\": { \"slowlog\": { \"level\": \"info\", \"threshold\": { \"index\": { \"warn\": \"10s\", \"trace\": \"500ms\", \"debug\": \"2s\", \"info\": \"5s\" } }, \"source\": \"1000\" } }, \"translog\": { \"flush_threshold_size\": \"1024mb\", \"sync_interval\": \"120s\", \"durability\": \"async\" }, \"max_result_window\": \"5000\", \"number_of_replicas\": \"0\", \"routing\": { \"allocation\": { \"exclude\": { \"zone\": \"data\" }, \"total_shards_per_node\": \"1\" } }, \"search\": { \"slowlog\": { \"level\": \"TRACE\", \"threshold\": { \"fetch\": { \"warn\": \"200ms\", \"trace\": \"200ms\", \"debug\": \"100ms\", \"info\": \"100ms\" }, \"query\": { \"warn\": \"100ms\", \"trace\": \"200ms\", \"debug\": \"200ms\", \"info\": \"1s\" } } } }, \"number_of_shards\": \"1\", \"merge\": { \"scheduler\": { \"max_thread_count\": \"1\", \"max_merge_count\": \"200\" } } } } } GET _cat/shards/operator_document_index-2021-05-31?v PUT operator_document_index-2021-05-31/_settings { \"index\":{ \"routing\": { \"allocation\": { \"exclude\": { \"zone\": \"client\" }, \"total_shards_per_node\": \"1\" } } } } 1.2. ç´¢å¼•æ–‡æ¡£ POST operator_document_index-2021-05-31/log/1 { \"price\" : 10, \"productID\" : \"XHDK-A-1293-#fJ3\",\"time\" : \"2021-05-31\" } POST operator_document_index-2021-05-31/log/_bulk { \"index\": { \"_id\": 1 }} { \"price\" : 10, \"productID\" : \"XHDK-A-1293-#fJ3\",\"time\" : \"2021-05-31\" } { \"index\": { \"_id\": 2 }} { \"price\" : 20, \"productID\" : \"KDKE-B-9947-#kL5\",\"time\" : \"2021-05-31\" } { \"index\": { \"_id\": 3 }} { \"price\" : 30, \"productID\" : \"JODL-X-1937-#pV7\",\"time\" : \"2021-06-01\" } { \"index\": { \"_id\": 4 }} { \"price\" : 30, \"productID\" : \"QQPX-R-3956-#aD8\",\"time\" : \"2021-06-02\" } GET _cat/indices/operator_document_index-2021-05-31?v è¿”å›,docs.deleted health status index uuid pri rep docs.count docs.deleted store.size pri.store.size green open operator_document_index-2021-05-31 7dazxoVrTT2qrQCbBJNe4w 1 0 4 3 8.1kb 8.1kb 1.3. è·å–æ–‡æ¡£ http://39.104.94.193:9200/operator_document_index-2021-05-31/_search Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-31 "},"first/part04/":{"url":"first/part04/","title":"ç®€å•æœç´¢","keywords":"","body":"1. ç®€å•æœç´¢1. ç®€å•æœç´¢ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part04/lite_search.html":{"url":"first/part04/lite_search.html","title":"URIæœç´¢","keywords":"","body":"1. ç®€å•æœç´¢1.1. è½»é‡æœç´¢1. ç®€å•æœç´¢ åˆ›å»ºç´¢å¼• PUT cars { \"aliases\": {}, \"mappings\": { \"_doc\": { \"properties\": { \"color\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } }, \"make\": { \"type\": \"text\", \"fields\": { \"keyword\": { \"type\": \"keyword\", \"ignore_above\": 256 } } }, \"price\": { \"type\": \"long\" }, \"sold\": { \"type\": \"date\" } } } } } æ’å…¥æ•°æ® ~~~~ POST /cars/_doc/_bulk { \"index\": {}} { \"price\" : 10000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-10-28\" } { \"index\": {}} { \"price\" : 20000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-11-05\" } { \"index\": {}} { \"price\" : 30000, \"color\" : \"green\", \"make\" : \"ford\", \"sold\" : \"2014-05-18\" } { \"index\": {}} { \"price\" : 15000, \"color\" : \"blue\", \"make\" : \"toyota\", \"sold\" : \"2014-07-02\" } { \"index\": {}} { \"price\" : 12000, \"color\" : \"green\", \"make\" : \"toyota\", \"sold\" : \"2014-08-19\" } { \"index\": {}} { \"price\" : 20000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-11-05\" } { \"index\": {}} { \"price\" : 80000, \"color\" : \"red\", \"make\" : \"bmw\", \"sold\" : \"2014-01-01\" } { \"index\": {}} { \"price\" : 25000, \"color\" : \"blue\", \"make\" : \"ford\", \"sold\" : \"2014-02-12\" } 1.1. è½»é‡æœç´¢ URI Search è½»é‡æœç´¢ GET cars/_search?q=color:red GET cars/_search?q=color:red&analyzer=whitespace&df=make uriæ”¯æŒçš„å‚æ•° Name æè¿° q å¯¹åº”Query DSL çš„query_string,æ›´å¤šä¿¡æ¯è¯·å‚è€ƒQuery String Query df æŸ¥è¯¢ä¸­æœªå®šä¹‰å­—æ®µå‰ç¼€æ—¶ä½¿ç”¨çš„é»˜è®¤å­—æ®µ analyzer åˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶è¦ä½¿ç”¨çš„åˆ†æå™¨åç§°ã€‚ analyze_wildcard æ˜¯å¦åº”è¯¥åˆ†æé€šé…ç¬¦å’Œå‰ç¼€æŸ¥è¯¢ã€‚é»˜è®¤ä¸ºfalseã€‚ batched_reduce_size åè°ƒèŠ‚ç‚¹ä¸Šåº”ç«‹å³å‡å°‘çš„ç¢ç‰‡ç»“æœæ•°.å¦‚æœè¯·æ±‚ä¸­å¯èƒ½å­˜åœ¨å¤§é‡shardï¼Œåˆ™åº”å°†æ­¤å€¼ç”¨ä½œä¿æŠ¤æœºåˆ¶ï¼Œä»¥å‡å°‘æ¯ä¸ªæœç´¢è¯·æ±‚çš„å†…å­˜å¼€é”€ã€‚ default_operator è¦ä½¿ç”¨çš„é»˜è®¤è¿ç®—ç¬¦å¯ä»¥æ˜¯ANDæˆ–ORã€‚é»˜è®¤ä¸ºORã€‚ lenient å¦‚æœè®¾ç½®ä¸ºtrueï¼Œå°†å¯¼è‡´å¿½ç•¥åŸºäºæ ¼å¼çš„å¤±è´¥ï¼ˆå¦‚å‘æ•°å­—å­—æ®µæä¾›æ–‡æœ¬ï¼‰ã€‚é»˜è®¤ä¸ºfalseã€‚ explain å¯¹äºæ¯æ¬¡å‘½ä¸­ï¼ŒåŒ…å«å¦‚ä½•è®¡ç®—å‘½ä¸­åˆ†æ•°çš„è¯´æ˜ã€‚ _source æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ stored_fields æ•°æ®åº“ï¼ˆDatabaseï¼‰ sort ä¸€è¡Œæ•°æ®ï¼ˆRowï¼‰ track_scores ä¸€åˆ—æ•°æ®ï¼ˆColumnï¼‰ track_total_hits æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ lenient ä¸€è¡Œæ•°æ®ï¼ˆRowï¼‰ explain ä¸€åˆ—æ•°æ®ï¼ˆColumnï¼‰ timeout æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ terminate_after æ•°æ®åº“ï¼ˆDatabaseï¼‰ from ä¸€è¡Œæ•°æ®ï¼ˆRowï¼‰ size ä¸€åˆ—æ•°æ®ï¼ˆColumnï¼‰ search_type æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ allow_partial_search_results æ•°æ®åº“çš„ç»„ç»‡å’Œç»“æ„ï¼ˆSchemaï¼‰ Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-31 "},"first/part04/distinct_search.html":{"url":"first/part04/distinct_search.html","title":"distinctç»Ÿè®¡","keywords":"","body":"1. å»é‡ç»Ÿè®¡1. å»é‡ç»Ÿè®¡ cardinalitycardinality-en GET /cars/_doc/_search { \"size\" : 0, \"aggs\" : { \"distinct_colors\" : { \"cardinality\" : { \"field\" : \"color.keyword\", \"precision_threshold\" : 100 } } } } #sqlè¯­å¥å†™æ³• POST /_xpack/sql?format=txt { \"query\": \"SELECT COUNT(DISTINCT color.keyword) AS car_color FROM cars\" } Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-30 "},"first/part04/term_search.html":{"url":"first/part04/term_search.html","title":"ç²¾å‡†æŸ¥è¯¢","keywords":"","body":"1. ç²¾å‡†å€¼æŸ¥è¯¢1. ç²¾å‡†å€¼æŸ¥è¯¢ ç²¾ç¡®å€¼æŸ¥æ‰¾ Termç›¸å…³æŸ¥è¯¢ POST /my_store/products/_bulk { \"index\": { \"_id\": 1 }} { \"price\" : 10, \"productID\" : \"XHDK-A-1293-#fJ3\" } { \"index\": { \"_id\": 2 }} { \"price\" : 20, \"productID\" : \"KDKE-B-9947-#kL5\" } { \"index\": { \"_id\": 3 }} { \"price\" : 30, \"productID\" : \"JODL-X-1937-#pV7\" } { \"index\": { \"_id\": 4 }} { \"price\" : 30, \"productID\" : \"QQPX-R-3956-#aD8\" } æ•°å­—ç²¾ç¡®æŸ¥è¯¢ GET /my_store/products/_search { \"query\" : { \"constant_score\" : { \"filter\" : { \"term\" : { \"price\" : 20 } } } } } POST /_xpack/sql?format=txt { \"query\": \"SELECT * FROM my_store WHERE price = 20\" } æ–‡æœ¬ç²¾ç¡®æŸ¥è¯¢ GET /my_store/products/_search { \"query\" : { \"constant_score\" : { \"filter\" : { \"term\" : { \"productID.keyword\": \"XHDK-A-1293-#fJ3\" } } } } } # æŸ¥çœ‹æŠ¥é”™,xpackæ’ä»¶å¯¹sqlæ”¯æŒçš„ä¸æ˜¯ç‰¹åˆ«å¥½ POST /_xpack/sql?format=txt { \"query\": \"SELECT * FROM my_store WHERE productID.keyword = 'XHDK-A-1293-#fJ3'\" } Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-31 "},"first/part04/compound_filter_query.html":{"url":"first/part04/compound_filter_query.html","title":"ç»„åˆè¿‡æ»¤æŸ¥è¯¢","keywords":"","body":"1. ç»„åˆè¿‡æ»¤æŸ¥è¯¢1.1. å¸ƒå°”è¿‡æ»¤1. ç»„åˆè¿‡æ»¤æŸ¥è¯¢ ç»„åˆè¿‡æ»¤å™¨ 1.1. å¸ƒå°”è¿‡æ»¤ ä¸€ä¸ª bool è¿‡æ»¤å™¨ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š { \"bool\" : { \"must\" : [], \"should\" : [], \"must_not\" : [], } } mustæ‰€æœ‰çš„è¯­å¥éƒ½ å¿…é¡»ï¼ˆmustï¼‰ åŒ¹é…ï¼Œä¸ AND ç­‰ä»·ã€‚must_notæ‰€æœ‰çš„è¯­å¥éƒ½ ä¸èƒ½ï¼ˆmust notï¼‰ åŒ¹é…ï¼Œä¸ NOT ç­‰ä»·ã€‚shouldè‡³å°‘æœ‰ä¸€ä¸ªè¯­å¥è¦åŒ¹é…ï¼Œä¸ OR ç­‰ä»·ã€‚ GET /my_store/products/_search { \"query\" : { \"bool\" : { \"should\" : [ { \"term\" : {\"price\" : 20}}, { \"term\" : {\"productID.keyword\" : \"XHDK-A-1293-#fJ3\"}} ], \"must_not\" : { \"term\" : {\"price\" : 30} } } } } åµŒå¥—æŸ¥è¯¢ POST /_xpack/sql?format=txt { \"query\": \"SELECT * FROM my_store WHERE productID.keyword = 'KDKE-B-9947-#kL5' OR (productID.keyword = 'JODL-X-1937-#pV7' AND price = 30 )\" } GET /my_store/products/_search { \"query\" : { \"bool\" : { \"should\" : [ { \"term\" : {\"productID.keyword\": \"KDKE-B-9947-#kL5\"}}, { \"bool\" : { \"must\" : [ { \"term\" : {\"productID.keyword\": \"JODL-X-1937-#pV7\"}}, { \"term\" : {\"price\" : 30}} ] }} ] } } } Copyright Â© Songbai Yang all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2021-05-31 "}}